"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[63],{63:(e,t,r)=>{r.r(t),r.d(t,{default:()=>s});var o=r(43),n=r(60),i=r(862),a=r(579);function s(){const[e,t]=(0,o.useState)(""),r=(0,n.Zp)(),[s,d]=o.useState(""),[l,c]=o.useState(""),[m,h]=o.useState([]),u="undefined"!==typeof window&&localStorage.getItem("currency")||"TZS",[g,p]=o.useState(2600),[y,x]=o.useState(!1),[f,S]=o.useState(!1),[b,v]=o.useState("Cash on Delivery");o.useEffect(()=>{const e=JSON.parse(localStorage.getItem("cart")||"[]");h(e),x(!0),fetch("https://api.exchangerate.host/latest?base=TZS&symbols=USD").then(e=>e.json()).then(e=>{e&&e.rates&&e.rates.USD&&p(1/e.rates.USD),x(!1)}).catch(()=>x(!1))},[]);const j=e=>"USD"===u?y?"...":"$".concat((e/g).toFixed(2)):"TZS ".concat(e.toLocaleString()),w=m.reduce((e,t)=>e+(Number(t.price)||0),0);return(0,a.jsxs)("div",{style:{maxWidth:600,margin:"2rem auto",background:"#fff",borderRadius:16,boxShadow:"0 8px 32px rgba(0,0,0,0.08)",padding:"2rem"},children:[f&&(0,a.jsx)("div",{style:{color:"red",fontWeight:700,marginBottom:16,textAlign:"center"},children:f}),e&&(0,a.jsxs)("div",{style:{background:"#fee",color:"#c33",padding:"1rem",borderRadius:"8px",margin:"1rem 0",border:"1px solid #fcc",textAlign:"center"},children:[(0,a.jsx)("strong",{children:"Order Error:"})," ",e]}),(0,a.jsx)("h2",{style:{color:"#FFD700",fontWeight:800,fontSize:"1.5rem",marginBottom:18,textAlign:"center"},children:"Checkout"}),(0,a.jsxs)("div",{style:{marginBottom:24},children:[(0,a.jsx)("div",{style:{fontWeight:700,fontSize:"1.1rem",marginBottom:8},children:"Order Summary"}),(0,a.jsx)("ul",{style:{listStyle:"none",padding:0,marginBottom:12},children:m.map((e,t)=>(0,a.jsxs)("li",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:10},children:[(0,a.jsx)("img",{src:e.image,alt:e.name,style:{width:48,height:48,objectFit:"cover",borderRadius:8}}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)("div",{style:{fontWeight:700,fontSize:"1rem",color:"#222"},children:e.name}),(0,a.jsxs)("div",{style:{color:"#555",fontSize:"0.95rem"},children:["Size: ",e.size]}),(0,a.jsx)("div",{style:{color:"#FFD700",fontWeight:700},children:j(e.price)})]})]},t))}),(0,a.jsxs)("div",{style:{fontWeight:800,fontSize:"1.1rem",color:"#232F3E",textAlign:"right"},children:["Total: ",j(w)]})]}),(0,a.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),t(""),S(""),!b)return void S("Please select a payment method.");if(!m.length)return void S("Your cart is empty.");if(!l||l.trim().length<5)return void S("Please enter a valid phone number.");const o=JSON.parse(localStorage.getItem("user"))||{},n={name:o.name||"",email:o.email||"",phone:l.trim(),address:s};try{const e=((e,t)=>{const r=JSON.parse(localStorage.getItem("user"))||{},o=e.reduce((e,t)=>{const r="".concat(t.id||t._id,"-").concat(t.size);return e[r]||(e[r]={productId:t.id||t._id,name:t.name,price:Number(t.price),quantity:0,size:t.size||"",image:t.image||""}),e[r].quantity+=1,e},{}),n=Object.values(o),i=n.reduce((e,t)=>e+t.price*t.quantity,0);return{items:n,customer:{name:r.name||t.name||"",email:r.email||t.email||"",phone:t.phone||"",address:t.address||s},total:Number(i.toFixed(2)),currency:"TZS",orderDate:(new Date).toISOString()}})(m,n);await(async e=>{try{console.log("Sending order data:",e);const t=localStorage.getItem("token");if(!t)throw new Error("You must be logged in to place an order.");const r=await(0,i.$)("/api/orders",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)});return console.log("Order successful:",r),r}catch(t){throw console.error("Order placement failed:",t),t}})(e),window.dispatchEvent(new Event("productsUpdated")),localStorage.removeItem("cart"),h([]),r("/orders")}catch(a){t(a.message)}},style:{marginTop:24},children:[(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsx)("label",{style:{fontWeight:700,color:"#222",marginBottom:6,display:"block"},children:"Delivery Address"}),(0,a.jsx)("input",{type:"text",value:s,onChange:e=>d(e.target.value),required:!0,style:{width:"100%",padding:"0.7rem",borderRadius:8,border:"1px solid #ddd",fontSize:"1rem"},placeholder:"Enter your address"})]}),(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsx)("label",{style:{fontWeight:700,color:"#222",marginBottom:6,display:"block"},children:"Phone Number"}),(0,a.jsx)("input",{type:"tel",value:l,onChange:e=>c(e.target.value),required:!0,style:{width:"100%",padding:"0.7rem",borderRadius:8,border:"1px solid #ddd",fontSize:"1rem"},placeholder:"Enter your phone number"})]}),(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsx)("label",{style:{fontWeight:700,color:"#222",marginBottom:6,display:"block"},children:"Payment Method"}),(0,a.jsx)("div",{style:{display:"flex",gap:16,marginBottom:6},children:(0,a.jsx)("button",{type:"button",onClick:()=>v("Cash on Delivery"),style:{padding:"0.7rem 1.2rem",borderRadius:8,border:"2px solid #FFD700",background:"#FFF8DC",color:"#232F3E",fontWeight:700,fontSize:"1rem",cursor:"pointer",boxShadow:"0 2px 8px #FFD70044",outline:"none",transition:"all 0.2s"},children:"Cash on Delivery"})})]}),(0,a.jsx)("button",{type:"submit",style:{background:"#FFD700",color:"#222",border:"none",borderRadius:8,padding:"0.9rem 1.7rem",fontWeight:700,width:"100%",fontSize:"1.1rem",cursor:"pointer",marginTop:10},children:"Place Order"})]})]})}},862:(e,t,r)=>{r.d(t,{$:()=>i});var o=r(555);const n="https://clothing-site-backend.onrender.com";async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=await fetch("".concat(n).concat(e),(0,o.A)({credentials:"include"},t));if(!r.ok)try{const e=await r.json(),t=new Error(e.message||"API error: ".concat(r.status));throw t.data=e,t}catch(i){throw new Error("API error: ".concat(r.status))}return r.json()}}}]);
//# sourceMappingURL=63.af0e68e1.chunk.js.map