{"version":3,"file":"static/js/63.af0e68e1.chunk.js","mappings":"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","sources":["pages/Checkout.js","utils/api.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { fetchFromApi as apiFetch } from '../utils/api';\n\nexport default function Checkout() {\n  // ...existing code...\n  const [orderError, setOrderError] = useState('');\n  const navigate = useNavigate();\n  const [address, setAddress] = React.useState('');\n  const [phone, setPhone] = React.useState('');\n  const [cart, setCart] = React.useState([]);\n  const currency = typeof window !== 'undefined' ? (localStorage.getItem('currency') || 'TZS') : 'TZS';\n  const [usdRate, setUsdRate] = React.useState(2600);\n  const [loadingRate, setLoadingRate] = React.useState(false);\n  const [quotaError, setQuotaError] = React.useState(false);\n  const [paymentMethod, setPaymentMethod] = React.useState('Cash on Delivery');\n\n  React.useEffect(() => {\n    const items = JSON.parse(localStorage.getItem('cart') || '[]');\n    setCart(items);\n\n    setLoadingRate(true);\n    fetch('https://api.exchangerate.host/latest?base=TZS&symbols=USD')\n      .then(res => res.json())\n      .then(data => {\n        if (data && data.rates && data.rates.USD) {\n          setUsdRate(1 / data.rates.USD);\n        }\n        setLoadingRate(false);\n      })\n      .catch(() => setLoadingRate(false));\n  }, []);\n\n  const convertPrice = (price) => {\n    if (currency === 'USD') {\n      return loadingRate ? '...' : `$${(price / usdRate).toFixed(2)}`;\n    }\n    return `TZS ${price.toLocaleString()}`;\n  };\n\n  const total = cart.reduce((sum, item) => sum + (Number(item.price) || 0), 0);\n\n  // Prepare order data for backend\n  const prepareOrderData = (cart, customerInfo) => {\n    const user = JSON.parse(localStorage.getItem('user')) || {};\n\n    // Group items by ID and size to consolidate quantities\n    const groupedItems = cart.reduce((acc, item) => {\n      const key = `${item.id || item._id}-${item.size}`;\n      if (!acc[key]) {\n        acc[key] = {\n          productId: item.id || item._id,\n          name: item.name,\n          price: Number(item.price),\n          quantity: 0,\n          size: item.size || '',\n          image: item.image || ''\n        };\n      }\n      acc[key].quantity += 1; // Each item in the raw cart array represents a quantity of 1\n      return acc;\n    }, {});\n\n    const items = Object.values(groupedItems);\n\n    const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);\n\n    return {\n      items,\n      customer: {\n        name: user.name || customerInfo.name || '',\n        email: user.email || customerInfo.email || '',\n        phone: customerInfo.phone || '',\n        address: customerInfo.address || address,\n      },\n      total: Number(total.toFixed(2)),\n      currency: 'TZS',\n      orderDate: new Date().toISOString()\n    };\n  };\n\n  // Place order with detailed error logging\n  const handlePlaceOrder = async (orderData) => {\n    try {\n      console.log('Sending order data:', orderData);\n      const token = localStorage.getItem('token');\n      if (!token) {\n        throw new Error('You must be logged in to place an order.');\n      }\n      const result = await apiFetch('/api/orders', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify(orderData),\n      });\n      console.log('Order successful:', result);\n      return result;\n    } catch (error) {\n      console.error('Order placement failed:', error);\n      throw error;\n    }\n  };\n\n  // Main submit handler\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setOrderError('');\n    setQuotaError('');\n    if (!paymentMethod) {\n      setQuotaError('Please select a payment method.');\n      return;\n    }\n    if (!cart.length) {\n      setQuotaError('Your cart is empty.');\n      return;\n    }\n    if (!phone || phone.trim().length < 5) {\n      setQuotaError('Please enter a valid phone number.');\n      return;\n    }\n    // Prepare customer info\n    const user = JSON.parse(localStorage.getItem('user')) || {};\n    const customerInfo = {\n      name: user.name || '',\n      email: user.email || '',\n      phone: phone.trim(),\n      address,\n    };\n    try {\n      const orderData = prepareOrderData(cart, customerInfo);\n      await handlePlaceOrder(orderData);\n      window.dispatchEvent(new Event('productsUpdated'));\n      localStorage.removeItem('cart');\n      setCart([]);\n      navigate('/orders');\n    } catch (error) {\n      setOrderError(error.message);\n    }\n  };\n\n  return (\n    <div style={{ maxWidth: 600, margin: '2rem auto', background: '#fff', borderRadius: 16, boxShadow: '0 8px 32px rgba(0,0,0,0.08)', padding: '2rem' }}>\n      {quotaError && (\n        <div style={{ color: 'red', fontWeight: 700, marginBottom: 16, textAlign: 'center' }}>\n          {quotaError}\n        </div>\n      )}\n      {orderError && (\n        <div style={{ background: '#fee', color: '#c33', padding: '1rem', borderRadius: '8px', margin: '1rem 0', border: '1px solid #fcc', textAlign: 'center' }}>\n          <strong>Order Error:</strong> {orderError}\n        </div>\n      )}\n      <h2 style={{ color: '#FFD700', fontWeight: 800, fontSize: '1.5rem', marginBottom: 18, textAlign: 'center' }}>Checkout</h2>\n      <div style={{ marginBottom: 24 }}>\n        <div style={{ fontWeight: 700, fontSize: '1.1rem', marginBottom: 8 }}>Order Summary</div>\n        <ul style={{ listStyle: 'none', padding: 0, marginBottom: 12 }}>\n          {cart.map((item, idx) => (\n            <li key={idx} style={{ display: 'flex', alignItems: 'center', gap: 16, marginBottom: 10 }}>\n              <img src={item.image} alt={item.name} style={{ width: 48, height: 48, objectFit: 'cover', borderRadius: 8 }} />\n              <div style={{ flex: 1 }}>\n                <div style={{ fontWeight: 700, fontSize: '1rem', color: '#222' }}>{item.name}</div>\n                <div style={{ color: '#555', fontSize: '0.95rem' }}>Size: {item.size}</div>\n                <div style={{ color: '#FFD700', fontWeight: 700 }}>{convertPrice(item.price)}</div>\n              </div>\n            </li>\n          ))}\n        </ul>\n        <div style={{ fontWeight: 800, fontSize: '1.1rem', color: '#232F3E', textAlign: 'right' }}>Total: {convertPrice(total)}</div>\n      </div>\n      <form onSubmit={handleSubmit} style={{ marginTop: 24 }}>\n        <div style={{ marginBottom: 16 }}>\n          <label style={{ fontWeight: 700, color: '#222', marginBottom: 6, display: 'block' }}>Delivery Address</label>\n          <input\n            type=\"text\"\n            value={address}\n            onChange={e => setAddress(e.target.value)}\n            required\n            style={{ width: '100%', padding: '0.7rem', borderRadius: 8, border: '1px solid #ddd', fontSize: '1rem' }}\n            placeholder=\"Enter your address\"\n          />\n        </div>\n        <div style={{ marginBottom: 16 }}>\n          <label style={{ fontWeight: 700, color: '#222', marginBottom: 6, display: 'block' }}>Phone Number</label>\n          <input\n            type=\"tel\"\n            value={phone}\n            onChange={e => setPhone(e.target.value)}\n            required\n            style={{ width: '100%', padding: '0.7rem', borderRadius: 8, border: '1px solid #ddd', fontSize: '1rem' }}\n            placeholder=\"Enter your phone number\"\n          />\n        </div>\n        <div style={{ marginBottom: 16 }}>\n          <label style={{ fontWeight: 700, color: '#222', marginBottom: 6, display: 'block' }}>Payment Method</label>\n          <div style={{ display: 'flex', gap: 16, marginBottom: 6 }}>\n            <button\n              type=\"button\"\n              onClick={() => setPaymentMethod('Cash on Delivery')}\n              style={{\n                padding: '0.7rem 1.2rem',\n                borderRadius: 8,\n                border: '2px solid #FFD700',\n                background: '#FFF8DC',\n                color: '#232F3E',\n                fontWeight: 700,\n                fontSize: '1rem',\n                cursor: 'pointer',\n                boxShadow: '0 2px 8px #FFD70044',\n                outline: 'none',\n                transition: 'all 0.2s',\n              }}\n            >Cash on Delivery</button>\n          </div>\n        </div>\n        <button\n          type=\"submit\"\n          style={{ background: '#FFD700', color: '#222', border: 'none', borderRadius: 8, padding: '0.9rem 1.7rem', fontWeight: 700, width: '100%', fontSize: '1.1rem', cursor: 'pointer', marginTop: 10 }}\n        >Place Order</button>\n      </form>\n    </div>\n  );\n}\n","// Basic API utility for making requests\r\n// You can customize this as needed for your project\r\n\r\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'https://sabor-espanol-ed87.onrender.com';\r\n\r\nexport async function fetchFromApi(endpoint, options = {}) {\r\n  const res = await fetch(`${API_BASE_URL}${endpoint}`, {\r\n    credentials: 'include',\r\n    ...options,\r\n  });\r\n  if (!res.ok) {\r\n    // Try to parse the error response from the server\r\n    try {\r\n      const errorData = await res.json();\r\n      // Create a new error object with the server's message\r\n      const error = new Error(errorData.message || `API error: ${res.status}`);\r\n      error.data = errorData; // Attach full error data\r\n      throw error;\r\n    } catch (e) {\r\n      // If parsing fails, throw a generic error\r\n      throw new Error(`API error: ${res.status}`);\r\n    }\r\n  }\r\n  return res.json();\r\n}\r\n"],"names":["Checkout","orderError","setOrderError","useState","navigate","useNavigate","address","setAddress","React","phone","setPhone","cart","setCart","currency","window","localStorage","getItem","usdRate","setUsdRate","loadingRate","setLoadingRate","quotaError","setQuotaError","paymentMethod","setPaymentMethod","items","JSON","parse","fetch","then","res","json","data","rates","USD","catch","convertPrice","price","concat","toFixed","toLocaleString","total","reduce","sum","item","Number","_jsxs","style","maxWidth","margin","background","borderRadius","boxShadow","padding","children","_jsx","color","fontWeight","marginBottom","textAlign","border","fontSize","listStyle","map","idx","display","alignItems","gap","src","image","alt","name","width","height","objectFit","flex","size","onSubmit","async","e","preventDefault","length","trim","user","customerInfo","email","orderData","prepareOrderData","groupedItems","acc","key","id","_id","productId","quantity","Object","values","customer","orderDate","Date","toISOString","console","log","token","Error","result","apiFetch","method","headers","body","stringify","error","handlePlaceOrder","dispatchEvent","Event","removeItem","message","marginTop","type","value","onChange","target","required","placeholder","onClick","cursor","outline","transition","API_BASE_URL","process","fetchFromApi","endpoint","options","arguments","undefined","_objectSpread","credentials","ok","errorData","status"],"sourceRoot":""}